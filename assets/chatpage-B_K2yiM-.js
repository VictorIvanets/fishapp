import{j as e,r as o,u as C,v as f,a as b}from"./index-BHKmua6e.js";import{b as j,c as v,d as N,_ as x,e as S,u as A}from"./chatUser.hook-DXdcokns.js";function w(){return e.jsx("div",{className:"preloaderboxgradsize",children:e.jsx("div",{className:"preloadergradsize"})})}const k=()=>{const[t,{data:s,loading:c,error:m}]=j(x.addComment);return{addedComment:(r,a)=>{t({variables:{newCommentData:{user:r,comment:a}}})},loadingAddComment:c,errorAddComment:m,addComment:s&&s.CommentData}},y=()=>{const{loading:t,error:s,data:c}=v(x.allComment);return{loading:t,error:s,allComm:c&&c.allComments}},I=()=>{const[t,{data:s,loading:c,error:m}]=j(x.delComment);return{deletedCommentById:r=>{t({variables:{comId:r}})},loadingDelComment:c,errorDelComment:m,delComment:s&&s}},D=()=>{const{data:t,loading:s}=N(x.CommetChek);return{loadingSub:s,subdataComment:t&&t.commentAdded}},E="/fishapp/iconfishpage_chatout.svg",B=o.memo(t=>{const{login:s,subdata:c,outChat:m,setSelectUser:d}=t,{userId:r}=C(a=>a.user);return e.jsx("div",{className:"chatpageuser",children:e.jsxs("div",{className:"chatpage__userbox chatpage__itembox",children:[e.jsx("button",{className:"chatpage__outbtn",onClick:()=>m(r||""),children:e.jsx("div",{className:"chatpage__outbtn__btn__svgbox",children:e.jsx("img",{title:"ВИДАЛИТИ",src:E,className:"chatpage__outbtn__btn__svgbox__img",alt:"ВИДАЛИТИ"})})}),e.jsx("h3",{className:"margin1",children:"У ЧАТІ:"}),e.jsx("div",{className:"chatpage__useritems",children:c&&c.map(a=>s===a.user?e.jsx("div",{onClick:()=>{d(a.user)},className:"chatpage__myuser",children:e.jsx("p",{children:a.user})},a.userId):e.jsx("div",{onClick:()=>{d(a.user)},className:"chatpage__user",children:e.jsx("p",{children:a.user})},a.userId))})]})})}),F="/fishapp/iconfishpage_chatsend.svg",M=o.memo(({login:t,selectUser:s})=>{const{addedComment:c,loadingAddComment:m,errorAddComment:d}=k(),[r,a]=o.useState(""),[i,h]=o.useState(""),_=o.useRef(null);o.useEffect(()=>{h(s?`${s.toLocaleUpperCase()}> `:"")},[s]);const n=o.useCallback(async u=>{u.preventDefault();const p=u.target,{comment:g}=p;g.value.length&&(c(t,g.value),g.value="",a(""),h(""))},[c,t]),l=o.useCallback(u=>{a(u)},[]);return o.useEffect(()=>{_.current.focus()},[s]),e.jsx("form",{onSubmit:n,className:"addcomment",children:m?e.jsx(w,{}):d?e.jsx("h3",{children:d.message}):e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"addcomment__input",id:"comment",name:"comment",rows:5,cols:33,value:r||i,onChange:u=>l(u.target.value),ref:_}),e.jsx("button",{className:"addcomment__btn",children:e.jsx("div",{className:"addcomment__btn__svgbox",children:e.jsx("img",{title:"ВИДАЛИТИ",src:F,className:"addcomment__btn__svgbox__img",alt:"ВИДАЛИТИ"})})})]})})}),R="/fishapp/Messenger-Notification-Sound.mp3",U=o.memo(({login:t,allCommentData:s,loading:c,error:m,selectUser:d,deletedCommentById:r})=>{const a=o.useRef(null),i=o.useRef(null),h=new Audio(R),_=o.useCallback((n,l)=>{s&&s.length>3?l.current.scrollIntoView({behavior:"smooth"}):n.current.scrollIntoView()},[s]);return o.useEffect(()=>{if(h.play(),a&&i){const n=a,l=i;n&&l&&_(n,l)}},[s]),e.jsxs("div",{className:"chatpage__commentbox",children:[e.jsxs("div",{className:"chatpage__commentitembox ",children:[e.jsx("div",{ref:a}),c&&e.jsx(f,{}),m&&e.jsx("p",{children:m.message}),s&&s.map(n=>e.jsxs("div",{className:t===n.user?"chatpage__comment mycomment":"chatpage__comment",children:[e.jsxs("div",{className:"chatpage__comment__head",children:[e.jsx("h3",{className:"colorGreen",children:n.user}),e.jsxs("p",{children:[new Date(n.createdAt).getDate(),".",new Date(n.createdAt).getMonth()+1,".",new Date(n.createdAt).getFullYear()]}),e.jsxs("p",{children:[new Date(n.createdAt).getHours(),".",new Date(n.createdAt).getMinutes()]}),t===n.user?e.jsx("button",{className:"chatpage__comment__delbtn",onClick:()=>r(n.comId),children:"delete"}):""]}),e.jsx("div",{className:"chatpage__comment__text",children:e.jsx("h3",{className:"tajustify margin1left",children:n.comment})})]},n.comId)),e.jsx("div",{ref:i})]}),e.jsx(M,{selectUser:d,login:t})]})}),L=o.memo(()=>{const{login:t}=C(g=>g.user),{deletedCommentById:s}=I(),{loading:c,error:m,allComm:d}=y(),{subdata:r}=S(),{subdataComment:a}=D(),[i,h]=o.useState([]),_=b(),{userOutByUserId:n}=A(),[l,u]=o.useState(""),p=o.useCallback(g=>{_(-1),n(g)},[_,n]);return o.useEffect(()=>{h(a||d)},[a,d]),e.jsx("div",{className:"chatpage",children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"chatpage__section",children:[t&&e.jsx(B,{setSelectUser:u,login:t,subdata:r,outChat:p}),t&&e.jsx(U,{selectUser:l,login:t,allCommentData:i,loading:c,error:m,deletedCommentById:s})]})})})});export{L as default};
